《Mac电脑网络高可用保障》

特点总结：

此脚本可实时监控网络、尽量无感并自动切换到可用网络、结束时可看介入次数统计。比macOS自带的网络管理修复耗时更短更快速，比Speedify这类重型商业软件免费且轻量，逻辑和策略比网上零散的脚本更完整和优雅。

系统设计：

1. 硬件层：三个物理设备组合

 - 主力网络：新旧双路由并行，兼顾了新路由的性能和旧路由的平稳过渡。因旧路由未支持Mesh，考虑布线情况，选择并行而非主副。
 - 备用网络：独立的手机热点，作为应对宽带线路中断等重大故障的终极应急方案。

2. 软件层：机智策略的轻量脚本

- 精准监控：通过持续的外部网络检测，能识别出Wi-Fi连接正常但无法上网的“假死”状态，比系统自带的判断更灵敏。
- 分级恢复：
    1）. 优先唤醒：首先尝试“唤醒”macOS系统自身的网络优选机制，鼓励系统进行自我修复，这是最平滑的恢复方式。
    2）. 强制接管：若“唤醒”失败，则立刻强制切换到下一个可用的网络（从主力网络到备用网络），确保连接不中断。
- 主动优化：脚本启动时，会主动清理并优化系统首选网络列表，为macOS提供清晰的连接优先级“地图”，提升日常使用的稳定性。
- 全自动化：整个监控、判断、恢复过程无需任何手动介入，由脚本在后台自动完成，无感守护。


此脚本关键技术优势函数：

1. 智能的故障检测 (Intelligent Failure Detection)
精准判断：它不依赖于mac系统表面的Wi-Fi图标是否连接，而是通过持续 ping 外部服务器来判断真实的互联网连通性，能有效识别“连接正常但无法上网”的“假死”状态。

防止误判：内置失败阈值（FAILURE_THRESHOLD），只有在连续多次 ping 失败后才会触发切换，避免了因瞬时网络波动造成的频繁和不必要的切换。

2. 优雅的恢复策略 (Elegant Recovery Strategy)
“先礼后兵”：这是脚本最核心的智能之处。它会先尝试通过开关Wi-Fi来**“唤醒”和引导**macOS系统自身的优选机制进行恢复，这是一种更温和、更符合系统逻辑的方式。只有在引导失败后，才会启动强制命令进行切换。

自动回切：当切换到备用网络（如手机热点）后，脚本会周期性地（SYSTEM_RESELECT_INTERVAL）尝试探测主网络是否恢复，一旦恢复便会自动引导切回，确保您能尽快回到高速、低成本的主网络上。

3. 主动的系统优化 (Proactive System Optimization)
启动时优化：脚本在每次启动时，都会运行 ensure_preferred_networks 函数，它会清理并重建您系统中的首选网络列表，将您的主、备网络以最清晰的优先级关系（0, 1, 2...）写入系统。这能有效解决系统因配置混乱导致的连接问题，也是“网络更稳了”的重要原因之一。

4. 高度的灵活性与定制化 (High Flexibility & Customization)
支持多主网络：脚本的逻辑可以轻松支持一个包含多个SSID的“主网络圈”（例如您的 0, 1, 2），只要连接在其中任何一个，脚本都会认为处于正常的主网络模式。

用户配置清晰：所有关键参数（网络名称、密码、检测间隔、失败次数等）都集中在脚本头部的“用户配置区”，方便随时根据自己的需求进行调整。

5. 清晰的监控与反馈 (Clear Monitoring & Feedback)
详细日志：脚本会实时打印带时间戳的状态日志，对当前的网络状态、延迟、脚本模式以及它正在做什么一目了然。

量化统计：加入分类计数器，能明确告诉脚本总共成功切换了多少次，以及分别是通过“先礼”还是“后兵”成功的，让它的功劳可以被量化。

